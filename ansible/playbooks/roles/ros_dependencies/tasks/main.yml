---
# ROS dependencies installation

# Always include the variables file (contains known ROS dependencies)
- name: Include known ROS dependencies
  ansible.builtin.include_vars:
    file: "{{ role_path }}/vars/known_ros_dependencies.yml"

- name: Set ros_packages variable for backward compatibility
  ansible.builtin.set_fact:
    ros_packages: "{{ ros_dependencies_known_packages }}"

- name: Check which ROS packages are available
  ansible.builtin.shell: set -o pipefail && apt-cache policy {{ item }} | grep -q "Candidate:"
  args:
    executable: /bin/bash
  register: available_packages
  changed_when: false
  failed_when: false
  loop: "{{ ros_dependencies_known_packages }}"

- name: Install available ROS packages
  ansible.builtin.apt:
    name: "{{ item.item }}"
    state: present
    install_recommends: false
  loop: "{{ available_packages.results }}"
  when: item.rc == 0
